webpackJsonp([20],{"8VG2":function(e,t){},AXk9:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("INCx"),a=i.n(s),r=i("X2Oc"),l=(i("mw3O"),{name:"curd",components:{},data:function(){return{form_errors:[],cur_entity:{},add_url:"/api/role/add",list_url:"/api/role/list",del_url:"/api/role/del",set_default_url:"/api/role/default",del_list:new URLSearchParams,tableData:[],select_word:"",cur_page:1,page_size:10,total:0,multipleSelection:[],editVisible:!1,createVisible:!1,form:{enable:"1",type:"1"},props:{label:"label",children:"children"},access:[]}},created:function(){this.getData(),this.getAccessList()},computed:{},filters:{formatDate:function(e){var t=new Date(a()(1e3*e));return Object(r.c)(t,"yyyy-MM-dd HH:mm:ss")},statusFilter:function(e){return{0:"info",1:"success",2:"danger"}[e]}},methods:{setDefault:function(e){var t=this;this.$axios.post(this.set_default_url,Object(r.h)({id:e.id})).then(function(e){1==e.data.status?(t.$message.success("操作成功"),t.getData()):t.$message.error("操作失败, 错误码:"+e.data.status_code+e.data.msg)})},sortChange:function(e,t,i){this.sortcolumn=e.prop,this.sortorder=e.order,this.getData()},viewUser:function(){this.cur_entity.id?this.$router.push({name:"viewuser",params:this.cur_entity}):this.$message.info("请选择数据")},checkForm:function(){if(this.form.name&&void 0!=this.form.level)return!0;this.form_errors=[],this.form.name||this.form_errors.push("请输入角色名"),void 0==this.form.level&&this.form_errors.push("请输入权限等级")},doCreate:function(e){this.$nextTick(function(){var e=this;this.createVisible?this.form.accesses=this.$refs.tree.getCheckedKeys():this.form.accesses=this.$refs.treeEdit.getCheckedKeys(),this.$axios.post(this.add_url,Object(r.h)(this.form)).then(function(t){1==t.data.status?(e.$message.success("操作成功"),e.getData()):e.$message.error("操作失败, 错误码:"+t.data.status+t.data.msg),e.createVisible=!1,e.editVisible=!1})})},getAccessList:function(){var e=this;this.$axios.get("/api/access/list").then(function(t){e.access=t.data.result})},getData:function(){var e=this;this.$axios.get(this.list_url,{params:{search:this.select_word,sort:this.sortcolumn,direction:this.sortorder}}).then(function(t){e.tableData=t.data.result,e.total=t.data.total})},handleSizeChange:function(e){this.page_size=e,this.getData()},handleCurrentChange:function(e){this.cur_page=e,this.getData()},handleCurrentChangeRow:function(e){this.cur_entity=e},search:function(){this.getData()},handleEdit:function(e,t){this.form_errors=[],this.editVisible=!0,this.form=t,this.form.id=t.id;var i=this;this.$nextTick(function(){console.log(this.$refs.treeEdit.getCheckedKeys()),i.$refs.treeEdit.setCheckedKeys(t.accesses),console.log(t.accesses),console.log(this.$refs.treeEdit.getCheckedKeys())})},handleSelectionChange:function(e){this.multipleSelection=e},dataDel:function(e){var t=this,i=null;if(e)i=e;else{if(this.multipleSelection.length<=0)return void this.$message.info("未选择任何数据");this.del_list=this.multipleSelection.map(function(e){return e.id}),i=this.del_list}this.$confirm("是否确认此操作","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){t.$axios.post(t.del_url,Object(r.h)({id:i})).then(function(e){e.data.status>=1?(t.getData(),t.$message.success("删除成功")):t.$message.error("删除失败, 错误码: "+e.data.status)})}).catch(function(){})}}}),o={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"crumbs"},[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",[i("i",{staticClass:"el-icon-tickets"}),e._v(" 用户\n        ")]),e._v(" "),i("el-breadcrumb-item",[e._v("角色")])],1)],1),e._v(" "),i("div",{staticClass:"container"},[i("div",{staticClass:"handle-box"},[i("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus",size:"mini"},on:{click:function(t){e.createVisible=!0,e.form={enable:"1"}}}},[e._v("增加角色")]),e._v(" "),i("el-input",{staticClass:"handle-input",attrs:{size:"mini",placeholder:"请输入关键词"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search()}},model:{value:e.select_word,callback:function(t){e.select_word=t},expression:"select_word"}}),e._v(" "),i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.search}},[e._v("搜索")]),e._v(" "),i("div",{staticStyle:{float:"right"}},[i("el-button",{attrs:{size:"mini",icon:"search"},on:{click:function(t){return e.dataDel()}}},[e._v("删除")])],1)],1),e._v(" "),i("el-table",{attrs:{data:e.tableData,border:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange,"current-change":e.handleCurrentChangeRow}},[i("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:"角色名","min-width":"80",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{staticClass:"second-title"},[e._v("     "+e._s(t.row.name)+"  ")])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"desc",label:"描述","min-width":"80"}}),e._v(" "),i("el-table-column",{attrs:{prop:"level",label:"级别","min-width":"80",sortable:""}}),e._v(" "),i("el-table-column",{attrs:{prop:"default",label:"默认","min-width":"80",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(1===t.row.default?"✓":""))])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"type",label:"类型","min-width":"80",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(1===t.row.type?"审核角色":"系统角色"))])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"320"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini"},on:{click:function(i){return e.setDefault(t.row)}}},[e._v("\n            设为默认  \n            ")]),e._v(" "),i("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"编辑",expression:"'编辑'"}],attrs:{size:"mini"},on:{click:function(i){return e.handleEdit(t.$index,t.row)}}},[i("i",{staticClass:"el-iconbianji2 iconfont_no_margin sumeru_op_button"})]),e._v(" "),i("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"删除",expression:"'删除'"}],attrs:{size:"mini",type:"danger"},on:{click:function(i){return e.dataDel(t.row.id)}}},[i("i",{staticClass:"el-iconshanchu1 iconfont_no_margin sumeru_op_button sumeru_red"})])]}}])})],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"增加角色",visible:e.createVisible,width:"30%"},on:{"update:visible":function(t){e.createVisible=t}}},[i("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"角色名"}},[i("el-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{clearable:"",placeholder:"请输入角色名",size:"mini",type:"text",name:"task_name"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"权限等级"}},[i("el-input-number",{attrs:{size:"mini",step:1},model:{value:e.form.level,callback:function(t){e.$set(e.form,"level",t)},expression:"form.level"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"角色类型"}},[i("el-switch",{staticStyle:{"margin-top":"-5px"},attrs:{"active-color":"#000","inactive-color":"##3e9b87","active-text":"审核角色","inactive-text":"系统角色","active-value":"1","inactive-value":"0"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"描述"}},[i("el-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{clearable:"",placeholder:"请输入描述",size:"mini",type:"text",name:"task_name"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"权限列表"}},[i("el-tree",{ref:"tree",attrs:{data:e.access,props:e.props,"show-checkbox":"","node-key":"id"}})],1),e._v(" "),e.form_errors.length?i("el-form-item",{staticStyle:{color:"#f78989"}},[i("b",[e._v("出现以下问题 :")]),e._v(" "),i("ul",e._l(e.form_errors,function(t){return i("li",{key:t},[e._v(e._s(t))])}),0)]):e._e()],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.checkForm()&&e.doCreate()}}},[e._v("创建")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"编辑角色",visible:e.editVisible,width:"30%"},on:{"update:visible":function(t){e.editVisible=t}}},[i("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"角色名"}},[i("el-input",{attrs:{clearable:"",placeholder:"请输入角色名",size:"mini",type:"text",name:"task_name"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"权限等级"}},[i("el-input-number",{attrs:{size:"mini",step:1},model:{value:e.form.level,callback:function(t){e.$set(e.form,"level",t)},expression:"form.level"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"描述"}},[i("el-input",{attrs:{clearable:"",placeholder:"请输入描述",size:"mini",type:"text",name:"task_name"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"权限列表"}},[i("el-tree",{ref:"treeEdit",attrs:{data:e.access,props:e.props,"show-checkbox":"","node-key":"id","check-strictly":"","default-expand-all":""}})],1),e._v(" "),e.form_errors.length?i("el-form-item",{staticStyle:{color:"#f78989"}},[i("b",[e._v("出现以下问题 :")]),e._v(" "),i("ul",e._l(e.form_errors,function(t){return i("li",{key:t},[e._v(e._s(t))])}),0)]):e._e()],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){e.checkForm()&&e.doCreate()}}},[e._v("修 改")])],1)],1)],1)},staticRenderFns:[]};var n=i("VU/8")(l,o,!1,function(e){i("8VG2")},"data-v-8b4a7610",null);t.default=n.exports}});
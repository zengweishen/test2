webpackJsonp([35],{ONFY:function(e,t){},"h+Z1":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=a("bOdI"),s=a.n(r),o=a("INCx"),l=a.n(o),n=a("X2Oc"),c=(i={name:"curd",components:{},data:function(){return{form_errors:[],cur_entity:{},add_url:"/api/user/add",list_url:"/api/user/list",del_url:"/api/user/del",role_list_url:"/api/role/select",clear_url:"/api/user/clear",del_list:new URLSearchParams,tableData:[],select_word:"",cur_page:1,page_size:10,total:0,multipleSelection:[],invalidClearVisible:!1,editVisible:!1,createVisible:!1,form:{enable:"1",role_id:""},select_range_status:"0",invalid_status_options:[{value:0,name:"加载中",count:0}],role_options:[{value:"选项",label:"默认"}]}},created:function(){this.getRoleList(),this.getInvalidClearStatus(),this.getData()},computed:{},updated:function(){this.$desensitive()}},s()(i,"computed",{}),s()(i,"filters",{getDateDiff_timestamp:function(e){return Object(n.e)(e)},formatDate:function(e){var t=new Date(l()(1e3*e));return Object(n.c)(t,"yyyy-MM-dd HH:mm:ss")},statusFilter:function(e){return{0:"info",1:"success","-1":"danger"}[e]}}),s()(i,"methods",{doClearInvalid:function(){var e=this;this.$confirm("是否确认此操作","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){e.$axios.post(e.clear_url,Object(n.h)({id:e.select_range_status})).then(function(t){t.data.status>=1?(e.getData(),e.$message.success("删除成功"),e.invalidClearVisible=!1):e.$message.error("删除失败,  "+t.data.msg),e.invalidClearVisible=!1})}).catch(function(){})},getInvalidClearStatus:function(){var e=this;this.$axios.get(this.clear_url).then(function(t){e.invalid_status_options=t.data.result})},getRoleList:function(){var e=this;this.$axios.get(this.role_list_url,{params:{type:0}}).then(function(t){e.role_options=t.data.result,console.log(e.role_options)})},sortChange:function(e,t,a){this.sortcolumn=e.prop,this.sortorder=e.order,this.getData()},invalidClear:function(){this.invalidClearVisible=!0},viewUser:function(){this.cur_entity.id?this.$router.push({name:"viewuser",params:this.cur_entity}):this.$message.info("请选择数据")},checkForm:function(){if(this.form.username&&this.form.password&&this.form.repassword&&null!=this.form.enable&&this.form.password==this.form.repassword)return!0;this.form_errors=[],this.form.username||this.form_errors.push("请输入用户名"),this.form.password||this.form_errors.push("请输入密码"),this.form.repassword||this.form_errors.push("请输入重复密码"),this.form.repassword&&this.form.repassword&&this.form.username!==this.form.repassword&&this.form_errors.push("两次密码输入不一致"),this.form.enable||this.form_errors.push("请选择状态")},doCreate:function(e){var t=this;this.$axios.post(this.add_url,Object(n.h)(this.form)).then(function(e){1==e.data.status?(t.$message.success("操作成功"),t.getData()):t.$message.error("操作失败, 错误码:"+e.data.status+e.data.msg),t.createVisible=!1,t.editVisible=!1})},getData:function(){var e=this;this.$axios.get(this.list_url,{params:{search:this.select_word,page_index:this.cur_page,page_size:this.page_size,sort:this.sortcolumn,direction:this.sortorder}}).then(function(t){e.tableData=t.data.result,e.total=t.data.total})},handleSizeChange:function(e){this.page_size=e,this.getData()},handleCurrentChange:function(e){this.cur_page=e,this.getData()},handleCurrentChangeRow:function(e){this.cur_entity=e},search:function(){this.getData()},handleEdit:function(e,t){this.form_errors=[],this.editVisible=!0,this.form=t,delete this.form.create_time,this.form.enable=1==t.enable?"1":"0"},handleSelectionChange:function(e){this.multipleSelection=e},dataDel:function(e){var t=this,a=null;if(e)a=e;else{if(this.multipleSelection.length<=0)return void this.$message.info("未选择任何数据");this.del_list=this.multipleSelection.map(function(e){return e.id}),a=this.del_list}this.$confirm("是否确认此操作","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){t.$axios.post(t.del_url,Object(n.h)({id:a})).then(function(e){e.data.status>=1?(t.getData(),t.$message.success("删除成功")):t.$message.error("删除失败,  "+e.data.msg)})}).catch(function(){})}}),i),u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-tickets"}),e._v(" 用户\n      ")]),e._v(" "),a("el-breadcrumb-item",[e._v("用户")])],1)],1),e._v(" "),a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus",size:"mini"},on:{click:function(t){e.createVisible=!0,e.form={enable:"1"}}}},[e._v("新增用户")]),e._v(" "),a("el-input",{staticClass:"handle-input",attrs:{size:"mini",placeholder:"请输入关键词"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search()}},model:{value:e.select_word,callback:function(t){e.select_word=t},expression:"select_word"}}),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.search}},[e._v("搜索")]),e._v(" "),a("div",{staticStyle:{float:"right"}},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.getInvalidClearStatus(),e.invalidClear()}}},[e._v("失效用户清理")]),e._v(" "),a("el-button",{attrs:{size:"mini",icon:"search"},on:{click:function(t){return e.dataDel()}}},[e._v("批量删除")])],1)],1),e._v(" "),a("el-table",{attrs:{data:e.tableData,border:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange,"current-change":e.handleCurrentChangeRow,"sort-change":e.sortChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),a("el-table-column",{attrs:{prop:"username",label:"用户名","min-width":"150",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"用户是否离职",expression:"'用户是否离职'"},{name:"show",rawName:"v-show",value:"LOCAL"!=t.row.auth_from,expression:"scope.row.auth_from!='LOCAL'"}],style:1==t.row.ldap_online?"color:#3e9b87f3":"color:#b34040"},[e._v("●")]),e._v(" "),a("span",{staticClass:"second-title insight_sensitive"},[e._v(e._s(t.row.username))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"role_name",label:"角色","min-width":"150",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"编辑时间","min-width":"180",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{attrs:{effect:"light",content:e._f("formatDate")(t.row.create_time),placement:"right"}},[a("span",[e._v(e._s(e._f("getDateDiff_timestamp")(t.row.create_time)))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"login_time",label:"最后登录","min-width":"180",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{attrs:{effect:"light",content:e._f("formatDate")(t.row.login_time),placement:"right"}},[a("span",[e._v(e._s(e._f("getDateDiff_timestamp")(t.row.login_time)))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"active_time",label:"最后活跃","min-width":"180",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{attrs:{effect:"light",content:e._f("formatDate")(t.row.active_time),placement:"right"}},[a("span",[e._v(e._s(e._f("getDateDiff_timestamp")(t.row.active_time)))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"enable",label:"启用状态","min-width":"150",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e._f("statusFilter")(t.row.enable)}},[e._v(e._s(t.row.enable>=0?1===t.row.enable?"启用":"禁用":"未激活"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"编辑",expression:"'编辑'"}],attrs:{size:"mini"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[a("i",{staticClass:"el-iconbianji2 iconfont_no_margin sumeru_op_button"})]),e._v(" "),a("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"删除",expression:"'删除'"}],attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.dataDel(t.row.id)}}},[a("i",{staticClass:"el-iconshanchu1 iconfont_no_margin sumeru_op_button sumeru_red"})])]}}])})],1),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{"current-page":e.cur_page,"page-sizes":[10,20,50,100],"page-size":e.page_size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.cur_page=t},"update:current-page":function(t){e.cur_page=t},"update:pageSize":function(t){e.page_size=t},"update:page-size":function(t){e.page_size=t},"update:total":function(t){e.total=t}}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"新建用户",visible:e.createVisible,width:"30%"},on:{"update:visible":function(t){e.createVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{attrs:{clearable:""},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码"}},[a("el-input",{attrs:{type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"重复密码"}},[a("el-input",{attrs:{type:"password"},model:{value:e.form.repassword,callback:function(t){e.$set(e.form,"repassword",t)},expression:"form.repassword"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"邮箱"}},[a("el-input",{attrs:{clearable:""},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.role_id,callback:function(t){e.$set(e.form,"role_id",t)},expression:"form.role_id"}},e._l(e.role_options,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"启用状态"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.enable,callback:function(t){e.$set(e.form,"enable",t)},expression:"form.enable"}},[a("el-option",{key:"1",attrs:{label:"启用",value:"1"}},[e._v("启用")]),e._v(" "),a("el-option",{key:"0",attrs:{label:"禁用",value:"0"}},[e._v("禁用")])],1)],1),e._v(" "),e.form_errors.length?a("el-form-item",{staticStyle:{color:"#f78989"}},[a("b",[e._v("出现以下问题 :")]),e._v(" "),a("ul",e._l(e.form_errors,function(t){return a("li",{key:t},[e._v(e._s(t))])}),0)]):e._e()],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.checkForm()&&e.doCreate()}}},[e._v("创建")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"编辑用户",visible:e.editVisible,width:"30%"},on:{"update:visible":function(t){e.editVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"密码"}},[a("el-input",{attrs:{type:"password","show-password":""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"邮箱"}},[a("el-input",{attrs:{clearable:""},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.role_id,callback:function(t){e.$set(e.form,"role_id",t)},expression:"form.role_id"}},e._l(e.role_options,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"启用状态"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.enable,callback:function(t){e.$set(e.form,"enable",t)},expression:"form.enable"}},[a("el-option",{key:"1",attrs:{label:"启用",value:"1"}},[e._v("启用")]),e._v(" "),a("el-option",{key:"0",attrs:{label:"禁用",value:"0"}},[e._v("禁用")])],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){return e.doCreate()}}},[e._v("修 改")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"失效用户清理",visible:e.invalidClearVisible,width:"30%"},on:{"update:visible":function(t){e.invalidClearVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"清理选项"}},[a("el-select",{staticClass:"handle-select mr10",attrs:{size:"mini",placeholder:"请选择时间段"},model:{value:e.select_range_status,callback:function(t){e.select_range_status=t},expression:"select_range_status"}},e._l(e.invalid_status_options,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.count))])])}),1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){return e.doClearInvalid()}}},[e._v("清理")])],1)],1)],1)},staticRenderFns:[]};var m=a("VU/8")(c,u,!1,function(e){a("ONFY")},"data-v-1199d486",null);t.default=m.exports}});